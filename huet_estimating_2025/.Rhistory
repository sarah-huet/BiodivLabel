.default = "Other FQS"
))
View(tmp_data)
35+12+12
35+19
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = weighted.mean(crop_area_ha,nobs,na.rm = T),
grassland_area_ha = weighted.mean(grassland_area_ha,nobs,na.rm = T),
nb_dairy_cow = weighted.mean(nb_dairy_cow,nobs,na.rm = T),
wheat_yield_t_ha = weighted.mean(wheat_yield_t_ha,nobs,na.rm = T),
milk_yield_kg_cow = weighted.mean(milk_yield_kg_cow,nobs,na.rm = T)
)
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T)
)
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
))
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
tmp_table
View(tmp_table)
unique(tmp_data$FQS)
library(gt)
library(dplyr)
library(tidyr)
tmp_data <- read.csv("~/BiodivLabel/CASD_export/CASD_export_250122/stat_desc_by_OTEX_2025-01-22.csv")
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter("AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster") %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter("AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster")
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter(FQS %in% "AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster") %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter(FQS %in% c("AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster")) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
library(gt)
library(dplyr)
library(tidyr)
tmp_data <- read.csv("~/BiodivLabel/CASD_export/CASD_export_250122/stat_desc_by_OTEX_2025-01-22.csv")
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter(FQS %in% c("AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster")) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventional",
FQS == "AB" ~"Organic farming",
.default = "Other FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
tmp_table %>%
# groups
mutate(OTEFDA = ifelse(row_number() == 1,
as.character(OTEFDA), ""),
.by = OTEFDA) %>%
select(OTEFDA,Variable,Conventionnel,AB,FQS) %>%
gt() %>%
cols_label(
OTEFDA = "Technical Orientation",
AB = "Organic Farming",
FQS = "Other FQSs"
) %>%
# replace NAs
sub_missing(missing_text = "-") %>%
# format numbers
fmt_auto()
library(gt)
library(dplyr)
library(tidyr)
tmp_data <- read.csv("~/BiodivLabel/CASD_export/CASD_export_250122/stat_desc_by_OTEX_2025-01-22.csv")
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter(FQS %in% c("AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster")) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventionnel",
FQS == "AB" ~"AB",
.default = "FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
tmp_table %>%
# groups
mutate(OTEFDA = ifelse(row_number() == 1,
as.character(OTEFDA), ""),
.by = OTEFDA) %>%
select(OTEFDA,Variable,Conventionnel,AB,FQS) %>%
gt() %>%
cols_label(
OTEFDA = "Technical Orientation",
AB = "Organic Farming",
FQS = "Other FQSs"
) %>%
# replace NAs
sub_missing(missing_text = "-") %>%
# format numbers
fmt_auto()
tmp_table %>%
# groups
mutate(OTEFDA = ifelse(row_number() == 1,
as.character(OTEFDA), ""),
.by = OTEFDA)
View(tmp_table)
library(gt)
library(dplyr)
library(tidyr)
tmp_data <- read.csv("~/BiodivLabel/CASD_export/CASD_export_250122/stat_desc_by_OTEX_2025-01-22.csv")
tmp_table <- tmp_data %>%
filter(OTEFDA %in% c(1516,4500,4700,6184)) %>%
filter(FQS %in% c("AB","Conventionnel","LR","Beurre de Charentes-Poitou",
"Bleu d'Auvergne - Cantal","Comte - Morbier","Fromages de Savoie","Munster")) %>%
mutate(FQS = case_when(
FQS == "Conventionnel" ~"Conventionnel",
FQS == "AB" ~"AB",
.default = "FQS"
)) %>%
group_by(OTEFDA,FQS) %>%
summarise(
nobs = sum(nobs,na.rm = T),
crop_area_ha = mean(crop_area_ha,na.rm = T),
grassland_area_ha = mean(grassland_area_ha,na.rm = T),
nb_dairy_cow = mean(nb_dairy_cow,na.rm = T),
wheat_yield_t_ha = mean(wheat_yield_t_ha,na.rm = T),
milk_yield_kg_cow = mean(milk_yield_kg_cow,na.rm = T),
.groups = "keep"
) %>% ungroup() %>%
mutate(OTEFDA = case_when(
OTEFDA == 1516 ~ "Field crops",
OTEFDA == 4500 ~ "Dairy cattle",
OTEFDA == 4700 ~ "Mixed cattle",
OTEFDA == 6184 ~ "Mixed crop and/or mixed livestock"
)) %>%
pivot_longer(cols = !c(OTEFDA,FQS),
names_to = "Variable",
values_to = "value") %>%
mutate(
Variable = case_when(
Variable == "nobs" ~ "Farm number",
Variable == "crop_area_ha" ~ "Crop area (ha)",
Variable == "grassland_area_ha" ~ "Permanent grassland area (ha)",
Variable == "nb_dairy_cow" ~ "Dairy herd size (number of cow)",
Variable == "wheat_yield_t_ha" ~ "Wheat yield (t/ha)",
Variable == "milk_yield_kg_cow" ~ "Milk yield (L/cow)"
)
) %>%
pivot_wider(
id_cols = c(OTEFDA,Variable),
names_from = FQS,
values_from = value
)
tmp_table %>%
# groups
mutate(OTEFDA = ifelse(row_number() == 1,
as.character(OTEFDA), ""),
.by = OTEFDA) %>%
select(OTEFDA,Variable,Conventionnel,AB,FQS) %>%
gt() %>%
cols_label(
OTEFDA = "Technical Orientation",
AB = "Organic Farming",
FQS = "Other FQSs"
) %>%
# replace NAs
sub_missing(missing_text = "-") %>%
# format numbers
fmt_auto()
library(dplyr)
library(tidyr)
library(gt)
source("~/BiodivLabel/huet_estimating_2025/result_tables.R")
tmp_data <- readr::read_csv("~/BiodivLabel/CASD_export/CASD_export_250122//table_ES_table_2025-01-22.csv")
tmp_table <- tmp_data %>%
left_join(.,practice_names$crops, by = join_by(id_col == practice)) %>%
select(land_use_type,id_col,labels,BVIAS_ES_5_95,set) %>%
pivot_wider(id_cols = c(land_use_type,id_col,labels),names_from = set,values_from = BVIAS_ES_5_95) %>%
arrange(.,land_use_type) %>%
filter(init != 0) %>%
mutate(ES_diff = optim/init)
tmp_table %>%
# groups
mutate(land_use_type = ifelse(row_number() == 1,
stringr::str_to_title(land_use_type), ""),
.by = land_use_type) %>%
gt() %>%
cols_label(
land_use_type = "Land use type",
id_col = "Variable",
labels = "Description",
init = "Effect size before optimization",
optim = "Effect size after optimization",
ES_diff = "Change in effect size (after / before)") %>%
# replace NAs
sub_missing(missing_text = "-") %>%
# format numbers
fmt_auto()
?fmt_auto
(0.00359382894288229 - 0.00492694225055246
)/0.00359382894288229
(0.00492694225055246 - 0.00359382894288229
)/0.00359382894288229
0.00492694225055246 / 0.00359382894288229
0.08/0.28
(0.28-0.08)/0.28
(0.28-0.11)/0.28
library(readxl)
results_comparison_CONTRA_BVIAS <- read_excel("C:/Users/srhuet/Nextcloud/Etude biodivlabel/Colloque/Sous-groupes de présentation/Pistes Méthodos/old/results_comparison_CONTRA-BVIAS.xlsx",sheet = "Feuille3")
library(dplyr)
library(tidyr)
tmp_plot_data <- results_comparison_CONTRA_BVIAS %>%
mutate(CONTRA = 1 - CONTRA/100) %>%
pivot_longer(.,cols = c("CONTRA","BVIAS_ha","BVIAS_t"),
names_to = "method",values_to = "values") %>%
mutate(plot_x = paste0(method,"_",Produit,"_",label)) %>%
mutate(
sd = case_when(
method == "BVIAS_ha" ~ sd_ha,
method == "BVIAS_t" ~ sd_t,
.default = NA
)
) %>% filter(!(Produit %in% c("Prairies de plaine")))
library(ggplot2)
library(ggrepel)
tmp_plot_data %>%
filter(!is.na(values)) %>%
ggplot() +
geom_point(aes(x = plot_x, y = values,colour = Produit),size = 7) +
geom_errorbar(aes(x = plot_x, ymin = values - sd, ymax = values + sd,colour = Produit),
linewidth=1,width = 0.5,position = position_dodge(width = 0.75)) +
#geom_line(aes(x = plot_x, y = values,group = label), colour = "#999999",linewidth = 2) +
#geom_line(aes(x = plot_x, y = values,group = c(Produit)), colour = "#999999",linewidth = 2) +
#geom_text(aes(x = plot_x, y = 1.2, label = label), angle = 90, hjust = 1) +
#geom_text_repel(aes(x = plot_x, y = values,label = label),                  angle = -90,size = 5, point.padding = 2)+
# theme
scale_y_continuous(c(0,1)) +
theme_light() +
theme(#axis.text = element_blank(),
axis.text.x = element_text(angle = 90),
axis.title = element_blank(),
strip.text = element_blank(),
legend.position = "bottom") +
scale_color_brewer(palette = "RdBu", direction = 1) +
facet_wrap(vars(method),scales = "free")
